# file-trail Project Rules

## TDD Workflow (CRITICAL - MUST FOLLOW)

This project uses Test-Driven Development (TDD) with the Red-Green-Refactor cycle.

### ⚠️ CRITICAL - MANDATORY PAUSE AND REVIEW ⚠️

**YOU MUST ALWAYS STOP AND ASK THE USER TO REVIEW AFTER EACH STEP (RED/GREEN/REFACTOR).**

**NEVER proceed to the next step without:**

1. Completing the current step (RED, GREEN, or REFACTOR)

2. Running the tests to verify the expected result (fail for RED, pass for GREEN/REFACTOR)

3. **STOPPING and explicitly asking the user to review**

4. **WAITING for the user to explicitly tell you to continue**

**This is NON-NEGOTIABLE. Do not skip this step for any reason.**

### TDD Process:

**Default Target: Unit Tests**

- TDD should target unit tests in `./src/index.spec.ts` by default
- Only target e2e tests in `./e2e/src/` when explicitly requested by the user

1. **RED**: Write a failing test first in `./src/index.spec.ts` (for unit tests) or `./e2e/src/` (for e2e tests, only when requested)

2. **GREEN**: Write the bare minimum code to make the test pass (even if messy)

3. **REFACTOR**: Clean up and improve the code while keeping tests green

   - **First**: Remove ALL code that is not necessary to make tests pass

   - Re-run tests to verify they still pass

   - **Then**: Proceed with any other refactorings (code organization, naming, etc.)

   - Re-run tests again to verify they still pass

### IMPORTANT - Pause and Review (MANDATORY):

- **After RED step**: 

  - Run the tests to verify they fail

  - **STOP and ask the user to review the failing test**

  - **DO NOT proceed to GREEN until user explicitly says to continue**

- **After GREEN step**: 

  - Run the tests to verify they pass

  - **STOP and ask the user to review the implementation**

  - **DO NOT proceed to REFACTOR until user explicitly says to continue**

- **After REFACTOR step**: 

  - First remove ALL unnecessary code and run tests to verify they still pass

  - Then proceed with other refactorings and run tests again to verify they still pass

  - **STOP and ask the user to review the refactored code**

- **DO NOT proceed** to the next step until the user explicitly tells you to continue

### Test Location:

- **Unit tests**: `./src/index.spec.ts` - Test the core library functionality
  - **Default target for TDD** - Write unit tests unless user explicitly requests e2e tests

- **E2E tests**: `./e2e/src/` - Test that the published npm package works correctly
  - Only use E2E tests for TDD when explicitly requested by the user

- Use Vitest with TypeScript for all tests

- Tests should be written before implementation code

### Test Structure:

- Each test must be organized with clear sections using comments:

  - `// arrange` - Setup and preparation steps

  - `// act` - Actions that trigger the behavior being tested

  - `// assert` - Verifications and expectations

- Omit blocks if they are empty or not applicable (e.g., if there are no setup steps, omit the `// arrange` block)

## Project Structure

- **Source**: TypeScript library code in `/src`
  - `index.ts` - Main library implementation
  - `index.spec.ts` - Unit tests

- **E2E**: End-to-end tests in `/e2e`
  - Tests verify the package works when installed as a dependency
  - Tests run against both local build and published npm package

- **Build**: Compiled output in `/dist`
  - Generated by `npm run build` (TypeScript + Vite)

## Development

- **Run unit tests**: `npm test` or `npm run test:watch` (watch mode)
- **Run e2e tests**: `npm run e2e` (builds first, then runs e2e tests)
- **Build**: `npm run build` (TypeScript compilation + Vite bundling)
- **Coverage**: `npm run test:coverage`

## Testing Philosophy

- Built with TDD - tests drive the implementation
- Unit tests cover core functionality
- E2E suite runs both before publishing (against local build) and after publishing (against actual npm package)
- This catches issues that only show up when the package is installed as a dependency
